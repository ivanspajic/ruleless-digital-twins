@prefix : <http://www.semanticweb.org/ivans/ontologies/2025/instance-model-1#>.
@prefix meta: <http://www.semanticweb.org/ivans/ontologies/2025/ruleless-digital-twins/>.
@prefix ssn: <http://www.w3.org/ns/ssn/>.
@prefix sosa: <http://www.w3.org/ns/sosa/>.



// These rules are used as a verification mechanism against malformed or impossible Conditions. In cases of errors, these rules will
// explicitly print error messages such that the coordinator catches them and throws exceptions.

// Verifies that system optimizations are not conflicting.
[ruleVer1a: (?platform rdf:type sosa:Platform)
            (?platform meta:optimizesFor ?propertyChange1)
            (?propertyChange1 ssn:forProperty ?property)
            (?platform meta:optimizesFor ?propertyChange2)
            (?propertyChange2 ssn:forProperty ?property)
            (?propertyChange1 meta:affectsPropertyWith meta:ValueIncrease)
            (?propertyChange2 meta:affectsPropertyWith meta:ValueDecrease)
            ->  print("Error!")
                print(?platform, "optimizes for", ?property, "with ValueIncrease through", ?propertyChange1)
                print(?platform, "optimizes for", ?property, "with ValueDecrease through", ?propertyChange2)
]

// Marks single-constraint Conditions, such as >15, for operator checks.
[ruleVer1b: (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode)
            (?condition ssn:forProperty ?conditionProperty)
            (?aNode rdf:type owl:Restriction)
            (?aNode owl:hasValue ?property)
            (?aNode owl:onProperty ?operator)
            ->  (?aNode :withCondition ?condition)
                (?aNode :withConditionProperty ?conditionProperty)
                (?aNode :withCheck "operator")
                (?aNode :withCheck "property")
]

// Marks conjunctive Conditions, such as >15 and <22, for further checks.
[ruleVer1c: (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode1)
            (?condition ssn:forProperty ?conditionProperty)
            (?aNode1 owl:intersectionOf ?aList1)
            (?aList1 rdf:first ?aNode2)
            (?aNode2 rdf:type owl:Restriction)
            (?aNode2 owl:hasValue ?boundProperty1)
            (?aNode2 owl:onProperty ?operator1)
            (?aList1 rdf:rest ?aList2)
            (?aList2 rdf:first ?aNode3)
            (?aNode3 rdf:type owl:Restriction)
            (?aNode3 owl:hasValue ?boundProperty2)
            (?aNode3 owl:onProperty ?operator2)
            makeTemp(?identifier)
            ->  (?aNode2 :withCondition ?condition)
                (?aNode2 :withIdentifier ?identifier)
                (?aNode2 :withConditionProperty ?conditionProperty)
                (?aNode2 :withCheck "conjunction")
                (?aNode2 :withCheck "operator")
                (?aNode2 :withCheck "property")
                (?aNode3 :withCondition ?condition)
                (?aNode3 :withIdentifier ?identifier)
                (?aNode3 :withConditionProperty ?conditionProperty)
                (?aNode3 :withCheck "conjunction")
                (?aNode3 :withCheck "operator")
                (?aNode3 :withCheck "property")
]

// Marks single-single-constraint disjunctive Conditions, such as <15 or >22, for further checks.
[ruleVer1d: (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode1)
            (?condition ssn:forProperty ?conditionProperty)
            (?aNode1 owl:unionOf ?aList1)
            (?aList1 rdf:first ?aNode2)
            (?aNode2 rdf:type owl:Restriction)
            (?aNode2 owl:hasValue ?boundProperty1)
            (?aNode2 owl:onProperty ?operator1)
            (?aList1 rdf:rest ?aList2)
            (?aList2 rdf:first ?aNode3)
            (?aNode3 rdf:type owl:Restriction)
            (?aNode3 owl:hasValue ?boundProperty2)
            (?aNode3 owl:onProperty ?operator2)
            ->  (?aNode2 :withCondition ?condition)
                (?aNode2 :withConditionProperty ?conditionProperty)
                (?aNode2 :withCheck "disjunction")
                (?aNode2 :withCheck "operator")
                (?aNode2 :withCheck "property")
                (?aNode3 :withCondition ?condition)
                (?aNode3 :withConditionProperty ?conditionProperty)
                (?aNode3 :withCheck "disjunction")
                (?aNode3 :withCheck "operator")
                (?aNode3 :withCheck "property")
]

// Marks double-single-constraint disjunctive Conditions, such as (>15 and <22) or >34, for further checks.
[ruleVer1e: (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode1)
            (?condition ssn:forProperty ?conditionProperty)
            (?aNode1 owl:unionOf ?aList1)
            (?aList1 rdf:first ?aNode2)
            (?aNode2 owl:intersectionOf ?aList2)
            (?aList2 rdf:first ?aNode3)
            (?aNode3 rdf:type owl:Restriction)
            (?aNode3 owl:hasValue ?boundProperty1)
            (?aNode3 owl:onProperty ?operator1)
            (?aList2 rdf:rest ?aList3)
            (?aList3 rdf:first ?aNode4)
            (?aNode4 rdf:type owl:Restriction)
            (?aNode4 owl:hasValue ?boundProperty2)
            (?aNode4 owl:onProperty ?operator2)
            (?aList1 rdf:rest ?aList4)
            (?aList4 rdf:first ?aNode5)
            (?aNode5 rdf:type owl:Restriction)
            (?aNode5 owl:hasValue ?boundProperty3)
            (?aNode5 owl:onProperty ?operator3)
            makeTemp(?identifier)
            ->  (?aNode3 :withCondition ?condition)
                (?aNode3 :withIdentifier ?identifier)
                (?aNode3 :withConditionProperty ?conditionProperty)
                (?aNode3 :withCheck "conjunction")
                (?aNode3 :withCheck "operator")
                (?aNode3 :withCheck "property")
                (?aNode4 :withCondition ?condition)
                (?aNode4 :withIdentifier ?identifier)
                (?aNode4 :withConditionProperty ?conditionProperty)
                (?aNode4 :withCheck "conjunction")
                (?aNode4 :withCheck "operator")
                (?aNode4 :withCheck "property")
                (?aNode5 :withCondition ?condition)
                (?aNode5 :withConditionProperty ?conditionProperty)
                (?aNode5 :withCheck "operator")
                (?aNode5 :withCheck "property")
]

// Marks double-double-constraint disjunctive Conditions such as (>15 and <22) or (>34 and <45), for further checks.
[ruleVer1f: (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode1)
            (?condition ssn:forProperty ?conditionProperty)
            (?aNode1 owl:unionOf ?aList1)
            (?aList1 rdf:first ?aNode2)
            (?aNode2 owl:intersectionOf ?aList2)
            (?aList2 rdf:first ?aNode3)
            (?aNode3 rdf:type owl:Restriction)
            (?aNode3 owl:hasValue ?boundProperty1)
            (?aNode3 owl:onProperty ?operator1)
            (?aList2 rdf:rest ?aList3)
            (?aList3 rdf:first ?aNode4)
            (?aNode4 rdf:type owl:Restriction)
            (?aNode4 owl:hasValue ?boundProperty2)
            (?aNode4 owl:onProperty ?operator2)
            (?aList1 rdf:rest ?aList4)
            (?aList4 rdf:first ?aNode5)
            (?aNode5 owl:intersectionOf ?aList5)
            (?aList5 rdf:first ?aNode6)
            (?aNode6 rdf:type owl:Restriction)
            (?aNode6 owl:hasValue ?boundProperty3)
            (?aNode6 owl:onProperty ?operator3)
            (?aList5 rdf:rest ?aList6)
            (?aList6 rdf:first ?aNode7)
            (?aNode7 rdf:type owl:Restriction)
            (?aNode7 owl:hasValue ?boundProperty4)
            (?aNode7 owl:onProperty ?operator4)
            makeTemp(?identifier1)
            makeTemp(?identifier2)
            ->  (?aNode3 :withCondition ?condition)
                (?aNode3 :withIdentifier ?identifier1)
                (?aNode3 :withConditionProperty ?conditionProperty)
                (?aNode3 :withCheck "conjunction")
                (?aNode3 :withCheck "operator")
                (?aNode3 :withCheck "property")
                (?aNode4 :withCondition ?condition)
                (?aNode4 :withIdentifier ?identifier1)
                (?aNode4 :withConditionProperty ?conditionProperty)
                (?aNode4 :withCheck "conjunction")
                (?aNode4 :withCheck "operator")
                (?aNode4 :withCheck "property")
                (?aNode6 :withCondition ?condition)
                (?aNode6 :withIdentifier ?identifier2)
                (?aNode6 :withConditionProperty ?conditionProperty)
                (?aNode6 :withCheck "conjunction")
                (?aNode6 :withCheck "operator")
                (?aNode6 :withCheck "property")
                (?aNode7 :withCondition ?condition)
                (?aNode7 :withIdentifier ?identifier2)
                (?aNode7 :withConditionProperty ?conditionProperty)
                (?aNode7 :withCheck "conjunction")
                (?aNode7 :withCheck "operator")
                (?aNode7 :withCheck "property")
]



// Prints errors if constraints use disallowed object properties as operators.
[ruleVer2a: (?aNode :withCheck "operator")
            (?aNode :withCondition ?condition)
            (?condition rdf:type meta:Condition)
            (?aNode owl:onProperty ?operator)
            notEqual(?operator, meta:equalTo)
            notEqual(?operator, meta:greaterThan)
            notEqual(?operator, meta:greaterThanOrEqualTo)
            notEqual(?operator, meta:lessThan)
            notEqual(?operator, meta:lessThanOrEqualTo)
            ->  print("Error!")
                print("Disallowed operator", ?operator, "used in Condition", ?condition)
]

// Prints errors if constraints use anything else in place of Properties as their bounds.
[ruleVer2b: (?aNode :withCheck "property")
            (?aNode :withCondition ?condition)
            (?condition rdf:type meta:Condition)
            (?aNode owl:hasValue ?property)
            notEqual(?property, "property")
            notEqual(?property, "operator")
            notEqual(?property, "conjunction")
            noValue(?property rdf:type ssn:Property)
            noValue(?property rdf:type sosa:ObservableProperty)
            noValue(?property rdf:type meta:ConfigurableParameter)
            ->  print("Error!")
                print("Disallowed Thing", ?property, "used in place of a Property in")
                print("Condition", ?condition)
]

// Prints errors if the condition property is anything other than a Property.
[ruleVer2c: (?aNode :withCheck "property")
            (?aNode :withCondition ?condition)
            (?condition rdf:type meta:Condition)
            (?aNode :withConditionProperty ?property)
            notEqual(?property, "property")
            notEqual(?property, "operator")
            notEqual(?property, "conjunction")
            noValue(?property rdf:type ssn:Property)
            noValue(?property rdf:type sosa:ObservableProperty)
            noValue(?property rdf:type meta:ConfigurableParameter)
            ->  print("Error!")
                print("Disallowed Thing", ?property, "used in place of a Property in")
                print("Condition", ?condition)
]

// Prints errors if Properties in Conditions have unsupported value types.
[ruleVer2d: (?aNode :withCheck "property")
            (?aNode :withCondition ?condition)
            (?condition rdf:type meta:Condition)
            (?aNode owl:hasValue ?property)
            (?property meta:hasValue ?value)
            notEqual(?property, "property")
            notEqual(?property, "operator")
            notEqual(?property, "conjunction")
            notDType(?value, xsd:double)
            notDType(?value, xsd:int)
            notDType(?value, xsd:dateTimeStamp)
            ->  print("Error!")
                print("Unsupported Property value type", ?value, "used in Condition", ?condition)
]



// The following rules print errors in cases of Conditions that are always impossible.

// = and < the same property is impossible.
[ruleVer2e: (?aNode1 :withCheck "conjunction")
            (?aNode2 :withCheck "conjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 :withIdentifier ?identifier1)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 :withIdentifier ?identifier2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            isBNode(?identifier1)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "conjunction")
            notEqual(?condition1, ?identifier1)
            notEqual(?condition1, ?identifier2)
            equal(?condition1, ?condition2)
            equal(?identifier1, ?identifier2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:equalTo)
            equal(?operator2, meta:lessThan)
            ->  print("Error!")
                print("Constraint in Condition", ?condition1, "requires that", ?conditionProperty, "be both")
                print(?operator1, "and", ?operator2, ?boundProperty1)
]

// = and > the same property is impossible.
[ruleVer2f: (?aNode1 :withCheck "conjunction")
            (?aNode2 :withCheck "conjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 :withIdentifier ?identifier1)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 :withIdentifier ?identifier2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            isBNode(?identifier1)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "conjunction")
            notEqual(?condition1, ?identifier1)
            notEqual(?condition1, ?identifier2)
            equal(?condition1, ?condition2)
            equal(?identifier1, ?identifier2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:equalTo)
            equal(?operator2, meta:greaterThan)
            ->  print("Error!")
                print("Constraint in Condition", ?condition1, "requires that", ?conditionProperty, "be both")
                print(?operator1, "and", ?operator2, ?boundProperty1)
]

// < and > the same property is impossible.
[ruleVer2g: (?aNode1 :withCheck "conjunction")
            (?aNode2 :withCheck "conjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 :withIdentifier ?identifier1)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 :withIdentifier ?identifier2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            isBNode(?identifier1)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "conjunction")
            notEqual(?condition1, ?identifier1)
            notEqual(?condition1, ?identifier2)
            equal(?condition1, ?condition2)
            equal(?identifier1, ?identifier2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:lessThan)
            equal(?operator2, meta:greaterThan)
            ->  print("Error!")
                print("Constraint in Condition", ?condition1, "requires that", ?conditionProperty, "be both")
                print(?operator1, "and", ?operator2, ?boundProperty1)
]

// < and >= the same property is impossible.
[ruleVer2h: (?aNode1 :withCheck "conjunction")
            (?aNode2 :withCheck "conjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 :withIdentifier ?identifier1)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 :withIdentifier ?identifier2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            isBNode(?identifier1)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "conjunction")
            notEqual(?condition1, ?identifier1)
            notEqual(?condition1, ?identifier2)
            equal(?condition1, ?condition2)
            equal(?identifier1, ?identifier2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:lessThan)
            equal(?operator2, meta:greaterThanOrEqualTo)
            ->  print("Error!")
                print("Constraint in Condition", ?condition1, "requires that", ?conditionProperty, "be both")
                print(?operator1, "and", ?operator2, ?boundProperty1)
]

// > and <= the same property is impossible.
[ruleVer2i: (?aNode1 :withCheck "conjunction")
            (?aNode2 :withCheck "conjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 :withIdentifier ?identifier1)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 :withIdentifier ?identifier2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            isBNode(?identifier1)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "conjunction")
            notEqual(?condition1, ?identifier1)
            notEqual(?condition1, ?identifier2)
            equal(?condition1, ?condition2)
            equal(?identifier1, ?identifier2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:greaterThan)
            equal(?operator2, meta:lessThanOrEqualTo)
            ->  print("Error!")
                print("Constraint in Condition", ?condition1, "requires that", ?conditionProperty, "be both")
                print(?operator1, "and", ?operator2, ?boundProperty1)
]



// These rules print errors in cases of Conditions that are always true (tautologies).

// > or <= the same property is always true.
[ruleVer2k: (?aNode1 :withCheck "disjunction")
            (?aNode2 :withCheck "disjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "disjunction")
            equal(?condition1, ?condition2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:greaterThan)
            equal(?operator2, meta:lessThanOrEqualTo)
            ->  print("Error!")
                print(?conditionProperty, "in Condition", ?condition1, "will always be", ?operator1, "or")
                print(?operator2, ?boundProperty1)
]

// < or >= the same property is always true.
[ruleVer2l: (?aNode1 :withCheck "disjunction")
            (?aNode2 :withCheck "disjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "disjunction")
            equal(?condition1, ?condition2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:lessThan)
            equal(?operator2, meta:greaterThanOrEqualTo)
            ->  print("Error!")
                print(?conditionProperty, "in Condition", ?condition1, "will always be", ?operator1, "or")
                print(?operator2, ?boundProperty1)
]

// >= or <= the same property is always true.
[ruleVer2m: (?aNode1 :withCheck "disjunction")
            (?aNode2 :withCheck "disjunction")
            (?aNode1 :withCondition ?condition1)
            (?condition1 rdf:type meta:Condition)
            (?condition1 ssn:forProperty ?conditionProperty)
            (?aNode1 owl:hasValue ?boundProperty1)
            (?aNode1 owl:onProperty ?operator1)
            (?aNode2 :withCondition ?condition2)
            (?aNode2 owl:hasValue ?boundProperty2)
            (?aNode2 owl:onProperty ?operator2)
            notEqual(?condition1, "property")
            notEqual(?condition1, "operator")
            notEqual(?condition1, "disjunction")
            equal(?condition1, ?condition2)
            equal(?boundProperty1, ?boundProperty2)
            equal(?operator1, meta:lessThanOrEqualTo)
            equal(?operator2, meta:greaterThanOrEqualTo)
            ->  print("Error!")
                print(?conditionProperty, "in Condition", ?condition1, "will always be", ?operator1, "or")
                print(?operator2, ?boundProperty1)
]