@prefix : <http://www.semanticweb.org/ivans/ontologies/2025/instance-model-1#>.
@prefix meta: <http://www.semanticweb.org/ivans/ontologies/2025/ruleless-digital-twins/>.
@prefix ssn: <http://www.w3.org/ns/ssn/>.
@prefix sosa: <http://www.w3.org/ns/sosa/>.



// These rules are used as a verification mechanism against malformed Conditions and OptimalConditions. In
// cases of errors, these rules will explicitly print messages such that the coordinator catches them and
// throws exceptions.

// Verifies that system optimizations are not conflicting.
[ruleVer1:  (?platform rdf:type sosa:Platform)
            (?platform meta:optimizesFor ?propertyChange1)
            (?propertyChange1 ssn:forProperty ?property)
            (?platform meta:optimizesFor ?propertyChange2)
            (?propertyChange2 ssn:forProperty ?property)
            (?propertyChange1 meta:affectsPropertyWith meta:ValueIncrease)
            (?propertyChange2 meta:affectsPropertyWith meta:ValueDecrease)
            ->  print("Conflicting optimizations detected!")
                print(?platform, "optimizes for", ?property, "with ValueIncrease through", ?propertyChange1)
                print(?platform, "optimizes for", ?property, "with ValueDecrease through", ?propertyChange2)
]

// These check that single-constraint Conditions/OptimalConditions, such as >15, use the allowed operators. 
[ruleVer2:  (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode)
            (?aNode rdf:type owl:Restriction)
            (?aNode owl:hasValue ?property)
            (?property rdf:type ssn:Property)
            (?aNode owl:onProperty ?operator)
            notEqual(?operator, meta:equalTo)
            notEqual(?operator, meta:greaterThan)
            notEqual(?operator, meta:greaterThanOrEqualTo)
            notEqual(?operator, meta:lessThan)
            notEqual(?operator, meta:lessThanOrEqualTo)
            ->  print("Unapproved operator used in Condition: ", ?operator)
]

[ruleVer2:  (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode)
            (?aNode rdf:type owl:Restriction)
            (?aNode owl:hasValue ?property)
            (?property rdf:type ssn:Property)
            (?aNode owl:onProperty ?operator)
            notEqual(?operator, meta:equalTo)
            notEqual(?operator, meta:greaterThan)
            notEqual(?operator, meta:greaterThanOrEqualTo)
            notEqual(?operator, meta:lessThan)
            notEqual(?operator, meta:lessThanOrEqualTo)
            ->  print("Unapproved operator used in Condition: ", ?operator)
]

// These check for conjunctive Conditions, such as >15 and <22.
[ruleVer9:  (?condition rdf:type meta:Condition)
            (?condition rdf:type ?aNode1)
            (?aNode1 owl:intersectionOf ?aList1)
            (?aList1 rdf:first ?aNode2)
            (?aNode2 rdf:type owl:Restriction)
            (?aNode2 owl:hasValue ?property1)
            (?property1 rdf:type ssn:Property)
            (?aList1 rdf:rest ?aList2)
            (?aList2 rdf:first ?aNode3)
            (?aNode3 rdf:type owl:Restriction)
            (?aNode3 owl:hasValue ?property2)
            (?property2 rdf:type ssn:Property)
            notEqual(?property1, ?property2)
            ->  (?aNode2 rdf:comment ?condition)
                (?aNode2 rdf:comment "conjunctive unverified")
                (?aNode3 rdf:comment ?condition)
                (?aNode3 rdf:comment "conjunctive unverified")
]

[ruleVer10: (?condition rdf:type meta:OptimalCondition)
            (?condition rdf:type ?aNode1)
            (?aNode1 owl:intersectionOf ?aList1)
            (?aList1 rdf:first ?aNode2)
            (?aNode2 rdf:type owl:Restriction)
            (?aNode2 owl:hasValue ?property1)
            (?property1 rdf:type ssn:Property)
            (?aList1 rdf:rest ?aList2)
            (?aList2 rdf:first ?aNode3)
            (?aNode3 rdf:type owl:Restriction)
            (?aNode3 owl:hasValue ?property2)
            (?property2 rdf:type ssn:Property)
            notEqual(?property1, ?property2)
            ->  (?aNode2 rdf:comment ?condition)
                (?aNode2 rdf:comment "conjunctive unverified")
                (?aNode3 rdf:comment ?condition)
                (?aNode3 rdf:comment "conjunctive unverified")
]

// TODO:
// check for single constraint conditions being useless or conflicting
// check for double + single constraint conditions being useless or conflicting
// check for double + double constraint conditions being useless or conflicting
// this should be done in the same fashion as before where we check for different types of conditions and mark them
// then, for every mark, we check different kinds of uselessness/conflicts